# Guide d'Int√©gration Frontend : Mesures Corporelles SMPL

Ce guide est destin√© √† l'√©quipe Mobile/Web pour l'int√©gration du microservice d'estimation de mensurations.

## üì° Sp√©cifications de l'API

- **Endpoint** : `POST /estimate`
- **Content-Type** : `multipart/form-data`
- **Auth** : (√Ä d√©finir selon votre gateway, ex: Bearer Token)

### Param√®tres de la requ√™te
| Cl√© | Type | Description |
| :--- | :--- | :--- |
| `photos` | File[] | **1 ou 2 fichiers** (Frontal + Profil recommand√© pour max pr√©cision). |
| `gender` | String | `"male"` ou `"female"`. |
| [height](file:///home/jonas-dev/Bureau/SassApp/smpl-microservice/smpl_engine.py#291-315) | Number | Taille en **cm** (ex: `175`). |
| `measures_table` | String | Liste s√©par√©e par virgules : `"tour_poitrine,taille,entrejambe"`. |
| `include_mesh` | Boolean | `"true"` pour recevoir une URL vers le mod√®le 3D .obj. |
| `include_visual_paths` | Boolean | `"true"` pour recevoir les coordonn√©es 3D (XYZ) du trac√© des mesures. |

---

## üõ°Ô∏è Gestion du "Pose Guard" (UX)

Le syst√®me int√®gre un garde-fou strict. Vous **devez** g√©rer les codes erreurs **400** pour guider l'utilisateur.

### Cas d'erreur types
- **Visibilit√© insuffisante** : L'utilisateur est trop pr√®s ou une partie du corps est coup√©e.
- **Pose non valide** : L'IA n'arrive pas √† aligner le squelette (bras coll√©s au corps, v√™tements trop amples).
- **Message √† afficher** : `"Pose non valide, veuillez vous reculer et √©carter l√©g√®rement les bras (forme en A)."`

---

## üé® Preview 3D : Utilit√© & Personnalisation

### 1. Est-ce n√©cessaire ?
**Commercialement : OUI.** 
M√™me si l'utilisateur veut juste ses chiffres, voir son "avatar 3D" :
- **Renforce la confiance** : "L'IA a vraiment compris ma morphologie".
- **Garantit la transparence** : On voit o√π les mesures ont √©t√© prises.
- **Effet "Wow"** : Positionne l'app comme une solution de pointe.

### 2. Comment le personnaliser (Tracer les lignes) ?
Pour "tracer" les lignes des mesures sur le corps (ex: un cercle rouge pour le tour de poitrine) :

**Option A (Client-side avec Three.js + `visual_paths`)** :
1. Activez `include_visual_paths: true` dans votre requ√™te.
2. L'API renvoie un objet `visual_paths` contenant pour chaque mesure une liste de points `[x, y, z]`.
3. Dans Three.js, cr√©ez une `BufferGeometry` √† partir de ces points et utilisez `LineLoop` ou `Line` pour dessiner le trac√© exact sur l'avatar.

```typescript
// Exemple de trac√© avec Three.js
const points = response.visual_paths.tour_poitrine.map(p => new THREE.Vector3(p[0], p[1], p[2]));
const geometry = new THREE.BufferGeometry().setFromPoints(points);
const material = new THREE.LineBasicMaterial({ color: 0xff0000 });
const line = new THREE.LineLoop(geometry, material);
scene.add(line);
```

**Option B (Texture Mapping)** :
G√©n√©rer une texture dynamique sur le serveur (heatmap ou lignes) et l'appliquer au mesh.

---

## üì∏ Guide de Capture (Best Practices pour le Front)

Pour maximiser le taux de succ√®s (√©viter les rejets du Pose Guard) :

1. **Overlay Silhouette** : Affichez une silhouette semi-transparente sur l'appareil photo pour aider l'utilisateur √† se positionner (bras en A, jambes √©cart√©es).
2. **D√©tection de flou** : V√©rifiez que l'image n'est pas floue avant l'envoi.
3. **Format** : Envoyez du **JPEG** compress√© (qualit√© 80) pour r√©duire la latence.

---

## üõ†Ô∏è Exemple de code (Ionic / TypeScript)

```typescript
async captureAndEstimate() {
  const formData = new FormData();
  formData.append('photos', frontBlob, 'front.jpg');
  formData.append('photos', profileBlob, 'profile.jpg');
  formData.append('gender', 'female');
  formData.append('height', '168');
  formData.append('measures_table', 'tour_poitrine,taille,hanche,entrejambe');
  formData.append('include_mesh', 'true');

  try {
    const res = await this.http.post('YOUR_API_URL/estimate', formData).toPromise();
    this.results = res.measurements;
    this.avatarUrl = res.mesh_url;
  } catch (err) {
    if (err.status === 400) {
      this.alertService.show(err.error.error); // "Pose non valide..."
    }
  }
}
```